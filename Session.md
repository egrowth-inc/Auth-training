# セッションベースの認証とは

## 概要

セッションベースの認証は、ユーザーがウェブアプリケーションにログインする際に、サーバー側でセッションを作成し、クライアント側（通常はブラウザ）にセッションIDをクッキーとして保存させる認証方法です。以降のリクエストでは、このセッションIDを使用してユーザーの認証状態を確認します。

---

## 主な特徴

- **状態を保持**: サーバー側でユーザーの状態（ログイン状態など）を保持します。
- **クッキーの利用**: クライアント側にセッションIDをクッキーとして保存し、リクエストごとに送信します。
- **セキュリティ**: セッションIDは推測困難なランダムな文字列であり、安全に管理されます。

---

## Laravelでのセッション設定

Laravelでは、セッションの保存方法をセッションドライバーで設定できます。`config/session.php`ファイルで確認し、必要に応じて以下のような設定を行いましょう。

- **セキュリティ設定**: secure、http_only、same_siteなどを適切に設定し、アプリケーションの運用環境に合わせたセキュリティレベルを確保します。

---

## セッションIDの生成と保存の流れ

1. **ユーザーの認証**: ユーザーがログインすると、Laravelは新しいセッションを生成し、セッションIDを作成します。
2. **クッキーへの保存**: セッションIDは、クライアントのブラウザにクッキーとして保存されます（デフォルトでは `laravel_session` という名前）。
3. **サーバー側の保存**: セッションデータは、選択したドライバーに基づいてサーバー側に保存されます。たとえば、`file` ドライバーを選択した場合、`storage/framework/sessions` ディレクトリにファイルとして保存されます。

---

## `storage/framework/sessions` ディレクトリ内のファイルの構成

セッションデータはシリアライズされた文字列として保存され、**連想配列（キーと値のペア）**で構成されています。主要なキーは以下の通りです：

- `_token`: CSRFトークンを保持
- `_flash`: フラッシュメッセージ用のデータ
- `_previous`: 前回のリクエスト情報

---

## 1.(`a:3:{...}`)

- **意味**: 配列（array）であり、要素数は3つです。

---

## 2. `_token`
- **キー**: `_token`
- **タイプ**: 文字列（string）
- **長さ**: 6文字
- **値**: `"IXobhuTLbJictJ0e9a3YGGZ8Lx855GEFQ9IjKguQ"`
  - **タイプ**: 文字列（string）
  - **長さ**: 40文字
- **説明**: 
  - これは**CSRF（クロスサイトリクエストフォージェリ）トークン**です。Laravelでは、フォーム送信時にこのトークンを使用してリクエストの正当性を検証します。

---

## 3. `_flash`
- **キー**: `_flash`
- **タイプ**: 文字列（string）
- **長さ**: 6文字
- **値**: 配列（array）
  - **要素数**: 2つ
  - **内容**:
    - `old`: 空の配列
    - `new`: 空の配列
- **説明**: 
  - これは**フラッシュデータ**を管理するための構造です。フラッシュデータは一度だけ表示されるメッセージ（例：成功メッセージやエラーメッセージ）を保持します。ここでは`old`と`new`が空のため、現在フラッシュデータは存在しない状態です。

---

## 4. `_previous`
- **キー**: `_previous`
- **タイプ**: 文字列（string）
- **長さ**: 9文字
- **値**: 配列（array）
  - **要素数**: 1つ
  - **内容**:
    - `url`: `"http://127.0.0.1:8000/register"`
      - **タイプ**: 文字列（string）
      - **長さ**: 30文字
- **説明**: 
  - このデータは前回のリクエストURLを保持しています。例えば、フォーム送信後に元のページへリダイレクトする際などに使用されます。

---
---

## 注意点
- **セッションの管理**: セッションの保存場所やセキュリティ設定を環境に応じて適切に設定することで、安全性を確保します。
- **セキュリティ設定**: 特に`secure`、`http_only`、`same_site`の設定は、セッションの安全性に大きく関わります。

---
## ログイン処理

![alt text](image-2.png)

![alt text](image-3.png)

![alt text](image-4.png)

![alt text](image-5.png)

セッションID:利用者を識別するID

セッション管理:セッションIDを用いて通信相手の状態を管理すること

## ログアウト処理

![alt text](image-6.png)

---

## セッションIDが保存されるのがcookie!


